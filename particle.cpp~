//*********************************************************************************************//
//                                      Plik particle.cpp                                      //
//*********************************************************************************************//

#include "particle.h"

//*********************************************************************************************//
//                            DrawBox - Rysuje sklejone piksele                                //
//*********************************************************************************************//
void Particle :: DrawBox(int x, int y, int color, int size, unsigned int *ptr)
{
  int xx,yy;
  if (size<1) return;
  if (size<3)
  ptr[1024*y+x]=color;
  
	for (xx=x-size/2;xx<x+size/2;xx++)
	{
		for (yy=y-size/2;yy<y+size/2;yy++)
      	{
			if ((xx>=0) && (yy>=0) && (xx<1024) && (yy<768))
			{
      			ptr[1024*yy+xx]=color;
			}
		}
	}
}

//*********************************************************************************************//
//                                   DrawParticle - Rysuje piksel                              //
//*********************************************************************************************//
void Particle :: DrawParticle(unsigned int *ptr)
{
	int ex, ey;
	float sz = 1/(z);
	ex = (int)(x + 250*sz*sx);
	ey = (int)(y - 250*sz*sy);

	if( (ex >= 0) && (ey >= 0) && (ex < 1024) && (ey < 768) )
	{
		if(energy > 0.1)
		{
			int pr = (unsigned int)(255*energy);
			int pg = (unsigned int)(210*energy);
			int pb = (unsigned int)(1*energy);
			int color = (pr << 16) + (pg << 8) + pb;

			DrawBox(ex, ey, color, (int)(2000/z), ptr);
		}
	}
	frame++;
}

//*********************************************************************************************//
//                                   MoveParticle - Porusza piksel                             //
//*********************************************************************************************//
void Particle :: MoveParticle()
{
	energy -= 0.007;
	if(energy > 0)
	{
		x += sx;
		y += sy;
		z += sz;
		sy += gravity;
		
		if(y < ground)
		{
			y = ground;
			sy = sy * bounce;
		}
	}
}


bool Particle :: dead()
{
	if(frame > 200)
	{
		return true;
	}

	return false;	
}

//*********************************************************************************************//
//                                DeleteParticle - Kasuje piksel                               //
//*********************************************************************************************//
void Particle :: DeleteParticle(Particle &t)
{
	t.~Particle();
}

//*********************************************************************************************//
//                                Koniec pliku particle.cpp                                    //
//*********************************************************************************************//



